<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>School Smart Kiosk</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="assistant.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #48f9ff, #e8fcff, #2ddefd);
            color: #333;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            position: relative;
        }


        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url("589431807_815813444550227_3889086255111213921_n.jpg");
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            opacity: 0.3;
            z-index: -1;
            pointer-events: none;
        }

        .container {
            max-width: 1200px;
            width: 100%;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            position: relative;
            z-index: 1;
            animation: fadeInScale 0.8s cubic-bezier(0.2, 0.8, 0.2, 1);
        }

        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.95);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        header {
            background: linear-gradient(-45deg, #2c3e50, #4ca1af, #2c3e50, #2980b9);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        @keyframes gradientBG {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        .school-info {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .school-logo {
            width: 70px;
            height: 70px;
            background-color: #fff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            color: #4ca1af;
        }

        h1 {
            font-size: 2.2rem;
            margin-bottom: 5px;
        }

        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .main-content {
            display: flex;
            min-height: 500px;
        }

        .sidebar {
            width: 250px;
            background: #2c3e50;
            color: white;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        .search-box {
            display: flex;
            margin-bottom: 20px;
            width: 100%;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            border: 2px solid transparent;
        }

        .search-box:focus-within {
            box-shadow: 0 5px 15px rgba(76, 161, 175, 0.3);
            border-color: #4ca1af;
            transform: translateY(-2px);
        }

        .search-box input {
            flex: 1;
            padding: 15px;
            border: none;
            font-size: 1.1rem;
            outline: none;
        }

        .search-box button {
            background: #4ca1af;
            color: white;
            border: none;
            padding: 0 20px;
            cursor: pointer;
            font-size: 1.2rem;
            transition: background 0.3s;
            flex-shrink: 0;
            /* Prevent button from shrinking */
            min-width: 50px;
            /* Ensure button has width */
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .search-box button:hover {
            background: #3a8a9a;
        }

        #voice-search-btn {
            background: #e74c3c !important;
            /* Force red background */
            border-left: 1px solid rgba(255, 255, 255, 0.2);
        }

        #voice-search-btn:hover {
            background: #c0392b;
        }

        #voice-search-btn.listening {
            animation: pulse-red 1.5s infinite;
            background: #c0392b;
        }

        @keyframes pulse-red {
            0% {
                box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.7);
            }

            70% {
                box-shadow: 0 0 0 10px rgba(231, 76, 60, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(231, 76, 60, 0);
            }
        }

        .nav-menu {
            list-style: none;
            margin-top: 10px;
            flex: 1;
        }

        .nav-menu li {
            margin-bottom: 15px;
        }

        .nav-menu a {
            color: white;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            border-radius: 8px;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            position: relative;
            overflow: hidden;
            border-left: 4px solid transparent;
        }

        .nav-menu a:hover {
            background: rgba(255, 255, 255, 0.1);
            padding-left: 18px;
            border-left-color: #4ca1af;
        }

        .nav-menu a.active {
            background: #4ca1af;
            box-shadow: 0 5px 15px rgba(76, 161, 175, 0.4);
            padding-left: 18px;
            border-left-color: white;
            font-weight: 600;
        }

        .nav-menu a:active {
            transform: scale(0.98);
        }

        .nav-menu i {
            width: 20px;
            text-align: center;
        }

        .content {
            flex: 1;
            padding: 25px;
            display: flex;
            flex-direction: column;
        }

        .welcome-banner {
            background: linear-gradient(to right, #3498db, #2c3e50);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
            text-align: center;
        }

        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            padding: 20px;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            animation: fadeInUp 0.8s ease backwards;
            position: relative;
            overflow: hidden;
        }

        /* Stagger animations for cards if possible, or just general slide up */
        .card:nth-child(1) {
            animation-delay: 0.1s;
        }

        .card:nth-child(2) {
            animation-delay: 0.2s;
        }

        .card:nth-child(3) {
            animation-delay: 0.3s;
        }

        .card:nth-child(4) {
            animation-delay: 0.4s;
        }

        .card:nth-child(5) {
            animation-delay: 0.5s;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
        }

        .card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #4ca1af;
        }

        .event-list,
        .directory-list {
            list-style: none;
        }

        .event-list li,
        .directory-list li {
            padding: 10px 0;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
        }

        .event-date {
            background: #4ca1af;
            color: white;
            padding: 3px 8px;
            border-radius: 5px;
            font-size: 0.9rem;
        }

        .map-container {
            flex: 1;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            min-height: 300px;
        }

        #map {
            width: 100%;
            height: 100%;
        }

        footer {
            background: #2c3e50;
            color: white;
            text-align: center;
            padding: 15px;
            font-size: 0.9rem;
        }

        /* Campus Directory Image Styles */
        .campus-map-container {
            margin-top: 15px;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
        }

        .campus-map-image {
            width: 100%;
            height: 350px;
            object-fit: cover;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .campus-map-image:hover {
            transform: scale(1.02);
        }

        .campus-map-placeholder {
            width: 100%;
            height: 350px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .campus-map-placeholder:hover {
            transform: scale(1.02);
        }

        .campus-map-placeholder i {
            font-size: 48px;
            margin-bottom: 10px;
        }

        .campus-map-placeholder span {
            font-size: 14px;
            opacity: 0.9;
        }

        /* Modal for enlarged map */
        .map-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .map-modal-content {
            max-width: 90%;
            max-height: 90%;
            background: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }

        .map-modal-content img {
            max-width: 100%;
            max-height: 70vh;
            border-radius: 8px;
        }

        .close-map-modal {
            background: #2c3e50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 15px;
        }

        /* ========== RESPONSIVE DESIGN ========== */

        /* Tablet Styles (769px - 1024px) */
        @media screen and (max-width: 1024px) {
            .main-content {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                flex-direction: row;
                flex-wrap: wrap;
                padding: 15px;
                gap: 15px;
                align-items: center;
                justify-content: space-between;
            }

            .search-box {
                width: 100%;
                max-width: 600px;
                margin: 0 auto;
            }

            .nav-menu {
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
                gap: 10px;
                margin-top: 15px;
                width: 100%;
            }

            .nav-menu li {
                margin-bottom: 0;
                flex: 1 1 auto;
                /* Allow flexible growth */
                min-width: 120px;
                /* Minimum width for touch targets */
            }

            .nav-menu a {
                padding: 12px;
                font-size: 0.95rem;
                justify-content: center;
                background: rgba(255, 255, 255, 0.1);
                /* Subtle background for visibility */
            }

            .card-grid {
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            }

            .map-modal-content {
                max-width: 95%;
                padding: 15px;
            }
        }

        /* Mobile Styles (up to 768px) */
        @media screen and (max-width: 768px) {
            body {
                padding: 10px;
            }

            .container {
                border-radius: 12px;
            }

            header {
                padding: 15px;
                display: flex;
                flex-direction: column;
                align-items: center;
            }

            .school-info {
                flex-direction: column;
                text-align: center;
                gap: 10px;
            }

            h1 {
                font-size: 1.6rem;
            }

            .subtitle {
                font-size: 1rem;
                margin-bottom: 5px;
            }

            .sidebar {
                padding: 15px 10px;
                gap: 10px;
            }

            .search-box input {
                padding: 12px;
                font-size: 1rem;
            }

            .nav-menu {
                gap: 8px;
            }

            .nav-menu li {
                min-width: 45%;
                /* 2 items per row mostly */
            }

            .nav-menu a {
                padding: 10px;
                font-size: 0.9rem;
                flex-direction: column;
                /* Stack icon and text for better mobile fit */
                gap: 5px;
                text-align: center;
            }

            .nav-menu i {
                font-size: 1.2rem;
                margin-bottom: 2px;
            }

            /* Removed display:none for span to keep text visible */

            .content {
                padding: 15px;
            }

            .card-grid {
                grid-template-columns: 1fr;
                /* Single column for clean vertical scroll */
                gap: 20px;
            }

            .card {
                padding: 20px;
                border-radius: 12px;
            }

            .card h3 {
                font-size: 1.1rem;
            }

            .building-card {
                height: 200px;
                /* Smaller height for mobile */
            }

            .building-title {
                font-size: 1.2rem;
            }

            footer {
                padding: 15px;
                font-size: 0.8rem;
            }

            /* Assistant Modal Mobile Adjustment */
            .assistant-modal .modal-content {
                width: 90%;
                max-width: none;
                padding: 20px;
                max-height: 85vh;
                /* Prevent overflow */
            }
        }

        /* Small Mobile Styles (up to 480px) */
        @media screen and (max-width: 480px) {
            body {
                padding: 0;
            }

            .container {
                border-radius: 0;
                /* Full width feel */
                box-shadow: none;
            }

            h1 {
                font-size: 1.3rem;
            }

            .nav-menu li {
                min-width: 40%;
            }

            .nav-menu a {
                font-size: 0.8rem;
            }

            .welcome-banner {
                padding: 15px;
                margin-bottom: 15px;
            }

            .card-grid {
                gap: 15px;
            }

            .member-image {
                width: 100px;
                height: 100px;
            }
        }
    </style>
    <style>
        /* About Us Styles - Injected here for organization */
        .about-title-card {
            grid-column: 1 / -1;
            background: linear-gradient(to right, #4ca1af, #2c3e50);
            color: white;
            text-align: center;
        }

        .about-title-card h3 {
            color: white;
            border-bottom-color: rgba(255, 255, 255, 0.3);
        }

        .member-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            padding: 25px;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .member-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .member-image {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 15px;
            border: 4px solid #4ca1af;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .member-name {
            font-size: 1.1rem;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .member-role {
            font-size: 0.9rem;
            color: #7f8c8d;
            background: #f0f2f5;
            padding: 4px 12px;
            border-radius: 15px;
        }

        /* News Styles */
        .news-image {
            width: 100%;
            height: 180px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .news-content h3 {
            margin-bottom: 10px;
            font-size: 1.1rem;
            color: #2c3e50;
        }

        .news-content p {
            font-size: 0.9rem;
            color: #666;
            line-height: 1.5;
        }

        /* Campus Directory Styles */
        .building-card {
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            position: relative;
            overflow: hidden;
            border-radius: 10px;
            height: 250px;
        }

        .building-card:hover {
            transform: scale(1.03);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .building-card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s;
        }

        .building-card:hover img {
            transform: scale(1.1);
        }

        .building-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            background: linear-gradient(transparent, rgba(0, 0, 0, 0.8));
            padding: 20px;
            color: white;
        }

        .building-title {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .building-desc {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* Rating Modal Styles */
        .rating-modal {
            display: none;
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            z-index: 2000;
            text-align: center;
            width: 300px;
            animation: slideRight 0.5s ease;
        }

        @keyframes slideRight {
            from {
                transform: translateX(-100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .rating-stars {
            font-size: 2rem;
            color: #ddd;
            margin: 10px 0;
            cursor: pointer;
        }

        .rating-stars i:hover {
            color: #f1c40f;
        }

        .close-rating {
            position: absolute;
            top: 5px;
            right: 10px;
            color: #999;
            cursor: pointer;
            font-size: 1.2rem;
        }

        /* Survey Styles */
        .survey-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .likert-scale {
            display: flex;
            justify-content: space-between;
            margin: 15px 0;
            border-bottom: 1px solid #eee;
            padding-bottom: 15px;
        }

        .likert-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 0.8rem;
            text-align: center;
            width: 18%;
        }

        .likert-option input {
            margin-bottom: 5px;
            cursor: pointer;
            width: 20px;
            height: 20px;
        }

        .survey-question {
            margin-bottom: 20px;
            background: #fff;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .survey-question h4 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .scale-legend {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
            font-size: 0.9rem;
            color: #555;
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
        }

        /* Virtual Keyboard Styles */
        .keyboard-container {
            display: none;
            /* Hidden by default */
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: #2c3e50;
            padding: 20px 20px 40px 20px;
            z-index: 9999;
            box-shadow: 0 -5px 15px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease-out;
            text-align: center;
        }

        @keyframes slideUp {
            from {
                transform: translateY(100%);
            }

            to {
                transform: translateY(0);
            }
        }

        .keyboard-row {
            display: flex;
            justify-content: center;
            margin-bottom: 10px;
            gap: 8px;
        }

        .key {
            padding: 10px;
            background-color: white;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 45px;
            color: #2c3e50;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 0 #bdc3c7, 0 5px 10px rgba(0, 0, 0, 0.1);
            transition: all 0.1s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            top: 0;
        }

        .key:active {
            box-shadow: 0 0 0 #bdc3c7, inset 0 2px 5px rgba(0, 0, 0, 0.1);
            top: 4px;
            background-color: #f0f3f4;
        }

        .key.special {
            background-color: #3498db;
            color: white;
            box-shadow: 0 3px 0 #2980b9;
            width: auto;
            padding-left: 20px;
            padding-right: 20px;
        }

        .key.special:active {
            background-color: #2980b9;
            box-shadow: 0 1px 0 #2980b9;
        }

        .key.space {
            width: 300px;
        }

        .key.close-keyboard {
            background-color: #e74c3c;
            color: white;
            box-shadow: 0 3px 0 #c0392b;
            position: absolute;
            top: 10px;
            right: 15px;
            padding: 8px 15px;
            width: auto;
            font-size: 1rem;
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <div class="school-info">
                <div class="school-logo">
                    <i class="fas fa-graduation-cap"></i>
                </div>
                <div>
                    <h1>Makati High School</h1>
                    <p class="subtitle">Smart Kiosk - Enhanced Navigation & Information System</p>
                </div>
            </div>
        </header>
        <div class="main-content">
            <div class="sidebar">
                <div class="search-box">
                    <input type="text" id="search-input" placeholder="Search for rooms, people..."
                        onkeypress="checkSearchEnter(event)">
                    <button id="voice-search-btn" onclick="startVoiceSearch()" title="Voice Search"><i
                            class="fas fa-microphone"></i></button>
                    <button id="search-btn" onclick="performSearch()"><i class="fas fa-search"></i></button>
                </div>
                <ul class="nav-menu">
                    <li><a href="#" onclick="setActiveNav(this); goHome()" class="active"><i class="fas fa-home"></i>
                            Home</a></li>
                    <li><a href="#" onclick="setActiveNav(this); showCampusDirectory()"><i
                                class="fas fa-map-marked-alt"></i> Campus
                            Directory</a></li>
                    <li><a href="#" onclick="setActiveNav(this); viewEvents()"><i class="fas fa-calendar-alt"></i>
                            Events</a></li>
                    <li><a href="#" onclick="setActiveNav(this); AboutUs()"><i class="fas fa-user-friends"></i> About
                            Us</a></li>
                    <li><a href="#" onclick="setActiveNav(this); viewNews()"><i class="fas fa-newspaper"></i> News</a>
                    </li>
                    <li><a href="#" onclick="setActiveNav(this); viewSurvey()"><i class="fas fa-poll"></i> Survey</a>
                    </li>
                    <li><a href="#" onclick="setActiveNav(this); viewHelp()"><i class="fas fa-question-circle"></i>
                            Help</a></li>
                </ul>
            </div>
            <div class="content">
                <div class="welcome-banner">
                    <h2>Welcome to Makati High School</h2>
                    <p id="date-time-display">Loading...</p>
                </div>
                <div class="card-grid" id="card-grid">
                    <div class="card" id="events-card">
                        <h3><i class="fas fa-calendar-day"></i> Today's Events</h3>
                        <ul class="event-list">
                            <li><span>Science Fair</span> <span class="event-date">10:00 AM</span></li>
                            <li><span>Basketball Practice</span> <span class="event-date">3:45 PM</span></li>
                            <li><span>Parent-Teacher Meeting</span> <span class="event-date">6:00 PM</span></li>
                        </ul>
                    </div>
                    <div class="card" id="announcements-card">
                        <h3><i class="fas fa-clipboard-list"></i> Announcements</h3>
                        <ul class="event-list">
                            <li>Yearbook photos will be taken next week</li>
                            <li>Library will close early on Friday</li>
                            <li>New cafeteria menu now available</li>
                        </ul>
                    </div>
                    <div class="card" id="directory-card">
                        <h3><i class="fas fa-map-marked-alt"></i> Campus Directory</h3>
                        <div class="campus-map-container">
                            <img src="Intelliguide.jpg" alt="Makati High School Campus Map" class="campus-map-image"
                                onclick="openMapModal()" title="Click to enlarge">
                        </div>
                        <ul class="directory-list" style="margin-top: 15px;">
                            <li><span>Building A</span> <span>Classrooms</span></li>
                            <li><span>Building B</span> <span>Labs & Library</span></li>
                            <li><span>Building C</span> <span>Admin Offices</span></li>
                        </ul>
                    </div>
                </div>

                <div class="map-container" id="map-container">
                    <iframe width="100%" height="400" frameborder="0" scrolling="no" marginheight="0" marginwidth="0"
                        id="gmap_canvas"
                        src="https://maps.google.com/maps?width=950&amp;height=400&amp;hl=en&amp;q=Gen.%20Luna%20Street%20Poblacion,%20Makati%20City%20Makati+(Makati%20High%20School)&amp;t=h&amp;z=18&amp;ie=UTF8&amp;iwloc=B&amp;output=embed"></iframe>
                    <a href='https://www.acadoo.de/'>ghostwriting</a>
                    <script type='text/javascript'
                        src='https://embedmaps.com/google-maps-authorization/script.js?id=dfe4639903d7cc4e19f8305d70f67ed7e9b2c164'></script>
                </div>
            </div>
        </div>
        <footer>
            <p>Makati High School Smart Kiosk | Gen. Luna Street Poblacion, Makati City | Principal's Office :
                890-8320 / 890-5938</p>
            <p>Â© 2025 Makati High School. All rights reserved.</p>
        </footer>
    </div>

    <!-- Campus Map Modal -->
    <div class="map-modal" id="map-modal">
        <div class="map-modal-content">
            <h3 style="margin-bottom: 15px; color: #2c3e50;"><i class="fas fa-map-marked-alt"></i> Makati High School
                Campus Map</h3>
            <img src="Intelliguide.jpg" alt="Makati High School Campus Map"
                style="max-width: 100%; max-height: 70vh; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.2);">
            <button class="close-map-modal" onclick="closeMapModal()">Close Map</button>
        </div>
    </div>

    <!-- Mini Assistant Button -->
    <div class="mini-assistant" id="mini-assistant">
        <i class="fas fa-graduation-cap"></i>
    </div>

    <!-- Assistant Modal -->
    <div class="assistant-modal" id="assistant-modal">
        <div class="modal-content">
            <h3>School Assistant</h3>
            <p id="assistant-greeting" class="typing">How can I help you today?</p>
            <div class="assistant-buttons">
                <button class="assistant-btn flash" id="navigate-btn" onclick="navigateRooms()"><i
                        class="fas fa-route"></i> Navigate Rooms</button>
                <button class="assistant-btn flash" id="events-btn" onclick="viewEvents()"><i
                        class="fas fa-calendar-day"></i> View Events</button>
                <button class="assistant-btn flash" id="announcements-btn" onclick="readAnnouncements()"><i
                        class="fas fa-clipboard-list"></i> Read Announcements</button>

                <button class="assistant-btn" onclick="callSchool()"><i class="fas fa-phone"></i> Call School</button>
                <button class="assistant-btn" onclick="showDirectory()"><i class="fas fa-users"></i> Staff
                    Directory</button>
                <button class="assistant-btn" onclick="openChatbot()"><i class="fas fa-robot"></i> Chat with AI</button>
            </div>
            <button class="close-modal" id="close-modal">Close</button>
        </div>
    </div>

    <!-- Rating Modal -->
    <div class="rating-modal" id="rating-modal">
        <div class="close-rating" onclick="closeRatingModal()">&times;</div>
        <h3 style="color: #2c3e50; margin-bottom: 5px;">Rate Your Experience</h3>
        <p style="font-size: 0.9rem; color: #777;">How likely are you to recommend us?</p>
        <div class="rating-stars" id="rating-stars">
            <i class="fas fa-star" onclick="rate(1)"></i>
            <i class="fas fa-star" onclick="rate(2)"></i>
            <i class="fas fa-star" onclick="rate(3)"></i>
            <i class="fas fa-star" onclick="rate(4)"></i>
            <i class="fas fa-star" onclick="rate(5)"></i>
        </div>
    </div>

    <!-- Date/Time Script -->
    <script>
        function updateDateTime() {
            const now = new Date();
            const options = {
                timeZone: 'Asia/Manila',
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            };
            const philippineTime = new Intl.DateTimeFormat('en-US', options).format(now);
            document.getElementById('date-time-display').textContent = 'Current Philippine Time: ' + philippineTime;
        }

        updateDateTime();
        setInterval(updateDateTime, 1000);
    </script>



    <!-- Assistant Modal Functions -->
    <script src="voice_search.js"></script>
    <script>
        // Wait for DOM to be fully loaded
        document.addEventListener('DOMContentLoaded', function () {
            const miniAssistant = document.getElementById('mini-assistant');
            const assistantModal = document.getElementById('assistant-modal');
            const closeModalBtn = document.getElementById('close-modal');

            // Open modal when clicking the mini assistant button
            miniAssistant.addEventListener('click', function () {
                assistantModal.style.display = 'flex';
            });

            // Close modal when clicking the close button
            closeModalBtn.addEventListener('click', function () {
                assistantModal.style.display = 'none';
            });

            // Close modal when clicking outside the modal content
            assistantModal.addEventListener('click', function (e) {
                if (e.target === assistantModal) {
                    assistantModal.style.display = 'none';
                }
            });
        });

        // Open Campus Map Modal
        function openMapModal() {
            document.getElementById('map-modal').style.display = 'flex';
        }

        // Close Campus Map Modal
        function closeMapModal() {
            document.getElementById('map-modal').style.display = 'none';
        }

        // Close map modal when clicking outside
        document.getElementById('map-modal').addEventListener('click', function (e) {
            if (e.target === this) {
                closeMapModal();
            }
        });

        // Active Navigation Helper
        function setActiveNav(element) {
            // Remove active class from all links
            const links = document.querySelectorAll('.nav-menu a');
            links.forEach(link => link.classList.remove('active'));

            // Add active class to clicked element
            if (element) {
                element.classList.add('active');
            }
        }

        // Home / Dashboard function
        function goHome() {
            const cardGrid = document.getElementById('card-grid');
            cardGrid.innerHTML = `
                    <div class="card" id="events-card">
                        <h3><i class="fas fa-calendar-day"></i> Today's Events</h3>
                        <ul class="event-list">
                            <li><span>Science Fair</span> <span class="event-date">10:00 AM</span></li>
                            <li><span>Basketball Practice</span> <span class="event-date">3:45 PM</span></li>
                            <li><span>Parent-Teacher Meeting</span> <span class="event-date">6:00 PM</span></li>
                        </ul>
                    </div>
                    <div class="card" id="announcements-card">
                        <h3><i class="fas fa-clipboard-list"></i> Announcements</h3>
                        <ul class="event-list">
                            <li>Yearbook photos will be taken next week</li>
                            <li>Library will close early on Friday</li>
                            <li>New cafeteria menu now available</li>
                        </ul>
                    </div>
                    <div class="card" id="directory-card">
                        <h3><i class="fas fa-map-marked-alt"></i> Campus Directory</h3>
                        <div class="campus-map-container">
                            <!-- Ensure openMapModal is globally available or defined -->
                            <img src="Intelliguide.jpg" alt="Makati High School Campus Map" class="campus-map-image"
                                onclick="openMapModal()" title="Click to enlarge">
                        </div>
                        <ul class="directory-list" style="margin-top: 15px;">
                            <li><span>Building A</span> <span>Classrooms</span></li>
                            <li><span>Building B</span> <span>Labs & Library</span></li>
                            <li><span>Building C</span> <span>Admin Offices</span></li>
                        </ul>
                    </div>
            `;
            // Ensure map container is visible if it was somehow hidden, though currently it is separate.
            // But if we navigated to getDirections, we might have scrolled away. 
            // We can optionally scroll to top.
            window.scrollTo({ top: 0, behavior: 'smooth' });

            document.getElementById('assistant-modal').style.display = 'none';
        }

        // Show Campus Directory function
        function showCampusDirectory() {
            const cardGrid = document.getElementById('card-grid');
            cardGrid.innerHTML = `
                <div class="card about-title-card">
                    <h3><i class="fas fa-map-marked-alt"></i> Campus Directory</h3>
                    <p>Select a building to view detailed locations</p>
                </div>

                <div class="building-card" onclick="viewBuilding('Building A')">
                    <img src="BUILDING A.jpg" alt="Building A">
                    <div class="building-overlay">
                        <div class="building-title">Building A</div>
                        <div class="building-desc">School Stage, Stockrooms, English Faculty</div>
                    </div>
                </div>

                <div class="building-card" onclick="viewBuilding('Building B')">
                    <img src="BUILDING B.jpg" alt="Building B">
                    <div class="building-overlay">
                        <div class="building-title">Building B</div>
                        <div class="building-desc">Principal's Office, Clinic, Dental Office</div>
                    </div>
                </div>

                <div class="building-card" onclick="viewBuilding('Building C')">
                    <img src="BUILDING C.jpg" alt="Building C">
                    <div class="building-overlay">
                        <div class="building-title">Building C</div>
                        <div class="building-desc">Cookery Lab, Computer Lab, E - Library</div>
                    </div>
                </div>

                <div class="building-card" onclick="viewBuilding('Building D')">
                    <img src="BUILDING D.jpg" alt="Building D">
                    <div class="building-overlay">
                        <div class="building-title">Building D</div>
                        <div class="building-desc">Senior High School Wing</div>
                    </div>
                </div>
            `;
            document.getElementById('assistant-modal').style.display = 'none';
        }

        // Image Mapping Data
        const buildingImages = {
            'Building A': {
                floors: {
                    1: 'Bldg. A 1F H1.jpg',
                    2: 'Bldg. A 2F H1.jpg'
                },
                floorData: {
                    1: [
                        { label: 'Room 102', desc: 'Standard Classroom', img: 'Building A 1F 102.jpg', directions: 'Building A - 1st Floor Room 102 Directions.jpg' },
                        { label: 'Room 103', desc: 'Standard Classroom', img: 'Building A 1F 103.jpg', directions: 'Building A - 1st Floor Room 103 Directions.jpg' },
                        { label: 'Backstage', desc: 'Backstage Area', img: 'Building A 1F Backstage.jpg', directions: 'Building A - STAGE Directions.jpg' },
                        { label: 'Stockroom', desc: 'Storage Room', img: 'Building A 1F Stockroom.jpg', directions: 'Building A - 1st Floor Room 101 Directions.jpg' },
                        { label: 'Restrooms', desc: 'Comfort Rooms', img: 'Building A 1F Restrooms.jpg', directions: 'Building A - 1st Floor Restroom Directions.jpg' }
                    ],
                    2: [
                        { label: 'Room 201', desc: 'Standard Classroom', img: 'Building A 2F 201.jpg', directions: 'Building A - 2nd Floor Room 201 Directions.jpg' },
                        { label: 'Room 202', desc: 'Standard Classroom', img: 'Building A 2F 202.jpg', directions: 'Building A - 2nd Floor Room 202 Directions.jpg' },
                        { label: 'Room 203', desc: 'Standard Classroom', img: 'Building A 2F 203.jpg', directions: 'Building A - 2nd Floor Room 203 Directions.jpg' },
                        { label: 'Room 204', desc: 'Standard Classroom', img: 'Building A 2F 204.jpg', directions: 'Building A - 2nd Floor Room 204 Directions.jpg' },
                        { label: 'English Faculty', desc: 'Faculty Room', img: 'Building A 2F ENG FACULTY.jpg', directions: 'Building A - 2nd Floor ENG Faculty Directions.jpg' },
                        { label: 'Restrooms', desc: 'Comfort Rooms', img: 'Building A 2F Restrooms.jpg', directions: 'Building A - 2nd Floor Restroom Directions.jpg' }
                    ]
                },
                rooms: {}
            },
            'Building B': {
                floors: {
                    1: 'Bldg. B 1F H1.jpg',
                    2: 'Bldg. B 2F H1.jpg'
                },
                floorData: {
                    1: [
                        { label: 'Room 101', desc: 'Standard Classroom', img: 'Building B 1F 101.jpg', directions: 'Building B - 1st Floor TLE Faculty (Room 112) Directions.jpg' },
                        { label: 'Room 106', desc: 'Standard Classroom', img: 'Building B 1F 106.jpg', directions: 'Building B - 1st Floor Prefect of Discipline (Room 106) Directions.jpg' },
                        { label: 'Room 111', desc: 'Standard Classroom', img: 'Building B 1F 111.jpg', directions: 'Building B - 1st Floor Food Room Directions.jpg' },
                        { label: 'Room 112', desc: 'Standard Classroom', img: 'Building B 1F 112.jpg', directions: 'Building B - 1st Floor TLE Faculty (Room 112) Directions.jpg' },
                        { label: 'Clinic', desc: 'School Clinic', img: 'Building B 1F Clinic.jpg', directions: 'Building B - 1st Floor Medical Clinic Directions.jpg' },
                        { label: 'Conference Room', desc: 'Conference Room', img: 'Building B 1F Conference Room.jpg', directions: 'Building B - 1st Floor Conference Room Directions.jpg' },
                        { label: 'Dental Office', desc: 'Dental Clinic', img: 'Building B 1F Dental Office.jpg', directions: 'Building B - 1st Floor Dental Office Directions.jpg' },
                        { label: 'Dept. Heads Office', desc: 'Department Heads', img: 'Building B 1F Department Heads Office.jpg', directions: 'Building B - 1st Floor Department Heads Directions.jpg' },
                        { label: 'Empty Grounds', desc: 'Open Area', img: 'Building B 1F Empty Grounds.jpg', directions: 'Building B - 1st Floor Empty Grounds Directions.jpg' },
                        { label: 'Asst. Principal', desc: 'Office of the Assistant School Principal', img: 'Building B 1F Office of the Assistant School Principal.jpg', directions: 'Building B - 1st Floor Office of the Assistant Principal Directions.jpg' },
                        { label: 'Principal\'s Office', desc: 'Office of the Principal', img: 'Building B 1F Office of the Principal.jpg', directions: 'Building B - 1st Floor Principal\'s Office Directions.jpg' },
                        { label: 'Registrar', desc: 'Office of the Registrar', img: 'Building B 1F Office of the Registrar.jpg', directions: 'Building B - 1st Floor Office of the Registrar Directions.jpg' },
                        { label: 'School Canteen', desc: 'Canteen', img: 'Building B 1F School Canteen.jpg', directions: 'Building B - 1st Floor School Canteen Directions.jpg' }
                    ],
                    2: [
                        { label: 'Room 202', desc: 'Standard Classroom', img: 'Building B 2F 202.jpg', directions: 'Building B - 2nd Floor Korean Class (Room 202) Directions.jpg' },
                        { label: 'Room 205', desc: 'Standard Classroom', img: 'Building B 2F 205.jpg', directions: 'Building B - 2nd Floor Room 205 Directions.jpg' },
                        { label: 'Journalism Room', desc: 'Journalism Room', img: 'Building B 2F Journalism Room.jpg', directions: 'Building B - 2nd Floor Journalism Room Directions.jpg' },
                        { label: 'Makerspace', desc: 'Makerspace', img: 'Building B 2F Makerspace.jpg', directions: 'Building B - 2nd Floor Makerspace Directions.jpg' },
                        { label: 'RHS Hall', desc: 'Hallway', img: 'Building B 2F RHS Hall.jpg', directions: 'Building B - 2nd Floor RHS Hall Directions.jpg' },
                        { label: 'Restrooms', desc: 'Comfort Rooms', img: 'Building B 2F Restrooms.jpg', directions: 'Building B - 2nd Floor Restroom Directions.jpg' }
                    ]
                },
                rooms: {}
            },
            'Building C': {
                floors: {
                    1: 'Bldg. C H1.jpg',
                    2: 'Bldg. C 2F H1.jpg'
                },
                floorData: {
                    1: [
                        { label: 'Room 101', desc: 'Standard Classroom', img: 'Building C 1F 101.jpg', directions: 'Building C - 1st Floor Cookery Lab (Room 101) Directions.jpg' },
                        { label: 'Room 105 (TVL)', desc: 'FBS Room', img: 'Building C 1F 105 TVL - FBS Room.jpg', directions: 'Building C - 1st Floor TVL-FBS Room Directions.jpg' },
                        { label: 'Room 106 (Cookery)', desc: 'Cookery Laboratory', img: 'Building C 1F 106 Cookery Laboratory.jpg', directions: 'Building C - 1st Floor Cookery Laboratory Directions.jpg' },
                        { label: 'JHS Guidance', desc: 'Guidance Office', img: 'Building C 1F JHS Guidance Office.jpg', directions: 'Building C - 1st Floor JHS Guidance Office Directions.jpg' },
                        { label: 'SHS Guidance', desc: 'Guidance Office', img: 'Building C 1F SHS Guidance Office.jpg', directions: 'Building C - 1st Floor SHS Guidance Office Directions.jpg' },
                        { label: 'Restrooms', desc: 'Comfort Rooms', img: 'Building C 1F Restrooms.jpg', directions: 'Building C - 1st Floor Restroom Directions.jpg' },
                        { label: 'Garden Area 1', desc: 'Outdoor Garden', img: 'Bldg. A,B,C Garden.jpg', directions: 'Building C - 1st Floor Teen Center Directions.jpg' },
                        { label: 'Garden Area 2', desc: 'Outdoor Garden', img: 'Bldg. A,B,C Garden 2.jpg', directions: 'Building C - 1st Floor Teen Center Directions.jpg' }
                    ],
                    2: [
                        { label: 'Room 201', desc: 'SHS Computer Lab', img: 'Building C 2F 201 SHS Computer Lab.jpg', directions: 'Building C - 2nd Floor Computer Laboratory (Room 201 - 202) Directions.jpg' },
                        { label: 'Room 202', desc: 'SHS Computer Lab', img: 'Building C 2F 202 SHS Computer Lab.jpg', directions: 'Building C - 2nd Floor Computer Laboratory (Room 201 - 202) Directions.jpg' },
                        { label: 'Room 204', desc: 'E-Library', img: 'Building C 2F 204 E - Library.jpg', directions: 'Building C - 2nd Floor E - Library (Room 204) Directions.jpg' },
                        { label: 'Room 205', desc: 'Standard Classroom', img: 'Building C 2F 205.jpg', directions: 'Building C - 2nd Floor Room 205 Directions.jpg' },
                        { label: 'Room 206', desc: 'Standard Classroom', img: 'Building C 2F 206.jpg', directions: 'Building C - 2nd Floor Room 206 Directions.jpg' },
                        { label: 'Finance Office', desc: 'School Finance', img: 'Building C 2F Finance Office.jpg', directions: 'Building C - 2nd Floor Finance Room (Room 207) Directions.jpg' },
                        { label: 'Restrooms', desc: 'Comfort Rooms', img: 'Building C 2F Restrooms.jpg', directions: 'Building C - 2nd Floor Restroom Directions.jpg' }
                    ]
                },
                rooms: {
                    // Fallbacks or other floors can still use the generic mapping if needed, 
                    // but floorData takes precedence for the specific floor.
                    '101': 'Building C 1F 101.jpg',
                    '102': 'Building C 1F 102.jpg', // Placeholder if not strictly existent
                    '105': 'Building C 1F 105 TVL - FBS Room.jpg',
                    '106': 'Building C 1F 106 Cookery Laboratory.jpg',
                    '201': 'Building C 2F 201 SHS Computer Lab.jpg',
                    '202': 'Building C 2F 202 SHS Computer Lab.jpg',
                    '204': 'Building C 2F 204 E - Library.jpg',
                    '205': 'Building C 2F 205.jpg',
                    '206': 'Building C 2F 206.jpg'
                }
            },
            'Building D': {
                floors: {
                    1: 'Bldg. D 1F H1.jpg',
                    2: 'Bldg. D 2F H1.jpg'
                },
                floorData: {
                    1: [
                        { label: 'Room 101', desc: 'Standard Classroom', img: 'Building D 1F 101.jpg', directions: 'Building D - 1st Floor Room 101 Directions.jpg' },
                        { label: 'Room 102', desc: 'Standard Classroom', img: 'Building D 1F 102.jpg', directions: 'Building D - 1st Floor Room 102 Directions.jpg' }
                    ],
                    2: [
                        { label: 'Room 201', desc: 'Standard Classroom', img: 'Building D 2F 201.jpg', directions: 'Building D - 2nd Floor Room 201 Directions.jpg' },
                        { label: 'Room 202', desc: 'Standard Classroom', img: 'Building D 2F 20.jpg', directions: 'Building D - 2nd Floor Room 202 Directions.jpg' }
                    ]
                },
                rooms: {
                    '101': 'Building D 1F 101.jpg',
                    '102': 'Building D 1F 102.jpg',
                    '201': 'Building D 2F 201.jpg',
                    '202': 'Building D 2F 20.jpg' // Filename as found in directory
                }
            }
        };

        function viewBuilding(buildingName) {
            const cardGrid = document.getElementById('card-grid');

            // Logic for floor count
            let floors = [1, 2]; // Default 2 floors for all buildings

            // If any building needs more floors in the future, add specific logic here

            let floorHtml = '';
            floors.forEach(floor => {
                // Determine Image Source
                let imgSrc = `${buildingName} Floor ${floor}.jpg`; // Default fallback
                if (buildingImages[buildingName] && buildingImages[buildingName].floors && buildingImages[buildingName].floors[floor]) {
                    imgSrc = buildingImages[buildingName].floors[floor];
                }

                floorHtml += `
                    <div class="card" onclick="viewFloor('${buildingName}', ${floor})" style="cursor:pointer; transition: transform 0.2s;">
                        <img src="${imgSrc}" onerror="this.src='placeholderimg.jpg'" style="width:100%; height:150px; object-fit:cover; border-radius:5px; margin-bottom:10px;" alt="${buildingName} Floor ${floor}">
                        <h4 style="color:#2c3e50; text-align:center;">Floor ${floor}</h4>
                        <p style="text-align:center; color:#777; font-size:0.85rem;">Classrooms & Facilities</p>
                    </div>
                `;
            });

            cardGrid.innerHTML = `
                <div class="card" style="grid-column: 1 / -1; display:flex; align-items:center; gap:15px; background:linear-gradient(to right, #2c3e50, #3498db); color:white;">
                    <button onclick="showCampusDirectory()" style="background:rgba(255,255,255,0.2); border:none; color:white; padding:10px 15px; border-radius:5px; cursor:pointer; font-size:1rem;">
                        <i class="fas fa-arrow-left"></i> Back to Directory
                    </button>
                    <h3 style="margin:0; border:none; color:white;">${buildingName} Detailed View</h3>
                </div>
                ${floorHtml}
            `;
        }

        function viewFloor(buildingName, floor) {
            const cardGrid = document.getElementById('card-grid');
            let roomHtml = '';

            // Check for specific floor data
            if (buildingImages[buildingName] && buildingImages[buildingName].floorData && buildingImages[buildingName].floorData[floor]) {
                const specificRooms = buildingImages[buildingName].floorData[floor];
                specificRooms.forEach(room => {
                    roomHtml += `
                        <div class="card" onclick="showNavigation('${buildingName}', '${room.label}')" style="transition: transform 0.2s; cursor: pointer;">
                            <img src="${room.img}" onerror="this.src='placeholderimg.jpg'" style="width:100%; height:200px; object-fit:cover; border-radius:5px; margin-bottom:10px;" alt="${room.label}">
                            <h4 style="color:#2c3e50; text-align:center;">${room.label}</h4>
                            <p style="text-align:center; color:#777; font-size:0.85rem;">${room.desc}</p>
                            <p style="text-align:center; color:#4ca1af; font-size:0.8rem; margin-top:5px;"><i class="fas fa-map-marker-alt"></i> Tap for Directions</p>
                        </div>
                    `;
                });
            } else {
                // Default Generation Logic (2 rooms per floor)
                const rooms = [1, 2];
                rooms.forEach(roomNum => {
                    const roomCode = `${floor}0${roomNum}`;
                    const roomLabel = `Room ${roomCode}`;

                    // Determine Image Source
                    let imgSrc = `${buildingName} ${roomLabel}.jpg`; // Default fallback
                    if (buildingImages[buildingName] && buildingImages[buildingName].rooms && buildingImages[buildingName].rooms[roomCode]) {
                        imgSrc = buildingImages[buildingName].rooms[roomCode];
                    }

                    roomHtml += `
                        <div class="card" onclick="showNavigation('${buildingName}', '${roomLabel}')" style="transition: transform 0.2s; cursor: pointer;">
                            <img src="${imgSrc}" onerror="this.src='placeholderimg.jpg'" style="width:100%; height:200px; object-fit:cover; border-radius:5px; margin-bottom:10px;" alt="${roomLabel}">
                            <h4 style="color:#2c3e50; text-align:center;">${roomLabel}</h4>
                            <p style="text-align:center; color:#777; font-size:0.85rem;">Standard Classroom</p>
                             <p style="text-align:center; color:#4ca1af; font-size:0.8rem; margin-top:5px;"><i class="fas fa-map-marker-alt"></i> Tap for Directions</p>
                        </div>
                    `;
                });
            }

            cardGrid.innerHTML = `
                <div class="card" style="grid-column: 1 / -1; display:flex; align-items:center; gap:15px; background:linear-gradient(to right, #4ca1af, #2c3e50); color:white;">
                    <button onclick="viewBuilding('${buildingName}')" style="background:rgba(255,255,255,0.2); border:none; color:white; padding:10px 15px; border-radius:5px; cursor:pointer; font-size:1rem;">
                        <i class="fas fa-arrow-left"></i> Back to ${buildingName}
                    </button>
                    <h3 style="margin:0; border:none; color:white;">${buildingName} - Floor ${floor}</h3>
                </div>
                ${roomHtml}
            `;
        }

        // Navigate Rooms function
        function navigateRooms() {
            const cardGrid = document.getElementById('card-grid');
            cardGrid.innerHTML =
                '<div class="card">' +
                '<h3><i class="fas fa-door-open"></i> Room Directory</h3>' +
                '<ul class="directory-list">' +
                '<li><span>Backstage / Stage</span> <span>Building A, 1st Floor</span></li>' +
                '<li><span>English Faculty</span> <span>Building A, 2nd Floor</span></li>' +
                '<li><span>Principal\'s Office</span> <span>Building B, 1st Floor</span></li>' +
                '<li><span>Asst. Principal\'s Office</span> <span>Building B, 1st Floor</span></li>' +
                '<li><span>Registrar\'s Office</span> <span>Building B, 1st Floor</span></li>' +
                '<li><span>Dept. Heads Office</span> <span>Building B, 1st Floor</span></li>' +
                '<li><span>School Clinic</span> <span>Building B, 1st Floor</span></li>' +
                '<li><span>Dental Office</span> <span>Building B, 1st Floor</span></li>' +
                '<li><span>Conference Room</span> <span>Building B, 1st Floor</span></li>' +
                '<li><span>School Canteen</span> <span>Building B, 1st Floor</span></li>' +
                '<li><span>Journalism Room</span> <span>Building B, 2nd Floor</span></li>' +
                '<li><span>Makerspace</span> <span>Building B, 2nd Floor</span></li>' +
                '<li><span>Guidance Office</span> <span>Building C, 1st Floor</span></li>' +
                '<li><span>Cookery Laboratory</span> <span>Building C, 1st Floor</span></li>' +
                '<li><span>TVL / FBS Room</span> <span>Building C, 1st Floor</span></li>' +
                '<li><span>Finance Office</span> <span>Building C, 2nd Floor</span></li>' +
                '<li><span>E-Library</span> <span>Building C, 2nd Floor</span></li>' +
                '<li><span>Computer Lab</span> <span>Building C, 2nd Floor</span></li>' +
                '<li><span>SHS Wing</span> <span>Building D</span></li>' +
                '</ul>' +
                '</div>';
            document.getElementById('assistant-modal').style.display = 'none';
        }

        // Auto Refresh and Rating Logic
        const REFRESH_TIME = 7 * 60 * 1000; // 7 minutes
        const RATING_TIME = 3 * 60 * 1000;  // 3 minutes

        setTimeout(() => {
            location.reload();
        }, REFRESH_TIME);

        setTimeout(() => {
            document.getElementById('rating-modal').style.display = 'block';
        }, RATING_TIME);

        function closeRatingModal() {
            document.getElementById('rating-modal').style.display = 'none';
        }

        function rate(stars) {
            const starElements = document.querySelectorAll('.rating-stars i');
            starElements.forEach((star, index) => {
                if (index < stars) {
                    star.style.color = '#f1c40f';
                } else {
                    star.style.color = '#ddd';
                }
            });

            const ratingData = {
                timestamp: new Date().toLocaleString(),
                type: 'Star Rating',
                rating: stars
            };
            // Save to LocalStorage
            let storedData = localStorage.getItem('survey_responses');
            let responses = storedData ? JSON.parse(storedData) : [];
            responses.push(ratingData);
            localStorage.setItem('survey_responses', JSON.stringify(responses));

            setTimeout(() => {
                alert('Thank you for your feedback! We appreciate your ' + stars + ' star rating.');
                closeRatingModal();
            }, 300);
        }

        function viewSurvey() {
            const cardGrid = document.getElementById('card-grid');
            const questions = [
                "Do you find the real-time announcements helpful in staying updated with school events and notices?",
                "Does the interactive map make it easier for you to locate rooms and facilities inside the school?",
                "Is the voice-touch inquiry feature convenient and accessible for you to use?",
                "Does the search function help you quickly and accurately find the information you need?",
                "Do you find the kiosk more reliable than bulletin boards or word-of-mouth announcements?",
                "Does using the kiosk help you save time in getting information compared to traditional methods?",
                "Do you feel more confident that the information from the kiosk is correct and updated?",
                "Does the kiosk make it easier to complete multiple tasks (e.g., checking schedules, announcements, menus)?",
                "Do you find the kiosk easy to use and understand, even without assistance?",
                "Overall, do you think the Intelliguide kiosk is a helpful tool for navigation and information access in school?"
            ];

            let questionsHtml = '';
            questions.forEach((q, index) => {
                questionsHtml += `
                    <div class="survey-question">
                        <h4>${index + 1}. ${q}</h4>
                        <div class="likert-scale">
                            <div class="likert-option"><input type="radio" name="q${index}" value="5" required><label>Strongly Agree</label></div>
                            <div class="likert-option"><input type="radio" name="q${index}" value="4"><label>Agree</label></div>
                            <div class="likert-option"><input type="radio" name="q${index}" value="3"><label>Neutral</label></div>
                            <div class="likert-option"><input type="radio" name="q${index}" value="2"><label>Disagree</label></div>
                            <div class="likert-option"><input type="radio" name="q${index}" value="1"><label>Strongly Disagree</label></div>
                        </div>
                    </div>
                `;
            });

            cardGrid.innerHTML = `
                <div class="card about-title-card">
                    <h3><i class="fas fa-poll"></i> User Feedback Survey</h3>
                    <p>Help us improve with your responses</p>
                </div>
                
                <div class="card" style="grid-column: 1 / -1;">
                    <div class="survey-container">
                        <form onsubmit="submitSurvey(event)">
                            <!-- Demographics -->
                            <div class="survey-question">
                                <h4>Respondent Information</h4>
                                <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                                    <div style="flex: 1; min-width: 200px;">
                                        <label style="display:block; margin-bottom:5px; font-weight:bold;">Name:</label>
                                        <input type="text" id="survey-name" required style="width:100%; padding:10px; border:1px solid #ddd; border-radius:5px;">
                                    </div>
                                    <div style="width: 100px;">
                                        <label style="display:block; margin-bottom:5px; font-weight:bold;">Age:</label>
                                        <input type="number" id="survey-age" required style="width:100%; padding:10px; border:1px solid #ddd; border-radius:5px;">
                                    </div>
                                </div>
                            </div>

                            <div class="survey-question">
                                <h4>Familiarity with Technology</h4>
                                <p style="font-size:0.9rem; margin-bottom:10px; color:#666;">Rate your comfort level with using technology.</p>
                                <div class="likert-scale">
                                    <div class="likert-option"><input type="radio" name="tech-familiarity" value="5" required><label>Very Familiar</label></div>
                                    <div class="likert-option"><input type="radio" name="tech-familiarity" value="4"><label>Familiar</label></div>
                                    <div class="likert-option"><input type="radio" name="tech-familiarity" value="3"><label>Neutral</label></div>
                                    <div class="likert-option"><input type="radio" name="tech-familiarity" value="2"><label>Unfamiliar</label></div>
                                    <div class="likert-option"><input type="radio" name="tech-familiarity" value="1"><label>Very Unfamiliar</label></div>
                                </div>
                            </div>

                            <hr style="margin: 20px 0; border: 0; border-top: 1px solid #eee;">

                            <div class="scale-legend">
                                <span>5: Strongly Agree</span>
                                <span>4: Agree</span>
                                <span>3: Neutral</span>
                                <span>2: Disagree</span>
                                <span>1: Strongly Disagree</span>
                            </div>

                            ${questionsHtml}
                            
                            <div class="survey-question">
                                <h4>Additional Comments</h4>
                                <textarea id="survey-comments" style="width:100%; padding:10px; border-radius:5px; border:1px solid #ddd; min-height:100px;" placeholder="Any other feedback?"></textarea>
                            </div>

                            <button type="submit" class="assistant-btn" style="width:100%; font-size: 1.1rem; justify-content: center;">Submit Survey</button>
                        </form>
                    </div>
                </div>
            `;
            document.getElementById('assistant-modal').style.display = 'none';
        }

        function submitSurvey(e) {
            e.preventDefault();

            // Gather data
            const name = document.getElementById('survey-name').value;
            const age = document.getElementById('survey-age').value;
            const techFamInput = document.querySelector('input[name="tech-familiarity"]:checked');
            const techFam = techFamInput ? techFamInput.value : "";
            const comments = document.getElementById('survey-comments').value;

            // Gather question answers
            const answers = {};
            for (let i = 0; i < 10; i++) {
                const qInput = document.querySelector(`input[name="q${i}"]:checked`);
                answers[`Q${i + 1}`] = qInput ? qInput.value : "";
            }

            const responseData = {
                timestamp: new Date().toLocaleString(),
                name: name,
                age: age,
                tech_familiarity: techFam,
                ...answers,
                comments: comments,
                type: 'Survey Response'
            };

            // Save to LocalStorage
            let storedData = localStorage.getItem('survey_responses');
            let responses = storedData ? JSON.parse(storedData) : [];
            responses.push(responseData);
            localStorage.setItem('survey_responses', JSON.stringify(responses));

            alert("Thank you for your feedback! Your responses have been saved.");
            location.reload();
        }

        function exportData() {
            let storedData = localStorage.getItem('survey_responses');
            if (!storedData) {
                alert("No data to export.");
                return;
            }
            const responses = JSON.parse(storedData);

            // Convert to CSV
            if (responses.length === 0) {
                alert("No data to export.");
                return;
            }

            // Collect all unique keys from all objects to ensure all columns (survey + ratings) are included
            const headersSet = new Set();
            responses.forEach(obj => Object.keys(obj).forEach(key => headersSet.add(key)));

            // Convert Set to Array and sort, putting timestamp/type/name first if they exist
            let headers = Array.from(headersSet);
            const priorityKeys = ['timestamp', 'type', 'rating', 'name', 'age', 'tech_familiarity'];
            headers.sort((a, b) => {
                const aIndex = priorityKeys.indexOf(a);
                const bIndex = priorityKeys.indexOf(b);
                if (aIndex !== -1 && bIndex !== -1) return aIndex - bIndex;
                if (aIndex !== -1) return -1;
                if (bIndex !== -1) return 1;
                return a.localeCompare(b);
            });

            const csvRows = [];
            csvRows.push(headers.join(','));

            for (const row of responses) {
                const values = headers.map(header => {
                    const val = row[header] !== undefined ? row[header] : "";
                    const escaped = ('' + val).replace(/"/g, '\\"');
                    return `"${escaped}"`;
                });
                csvRows.push(values.join(','));
            }

            const csvString = csvRows.join('\n');
            const blob = new Blob([csvString], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.setAttribute('hidden', '');
            a.setAttribute('href', url);
            a.setAttribute('download', 'survey_responses.csv');
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        // View Events function
        function viewEvents() {
            const cardGrid = document.getElementById('card-grid');
            cardGrid.innerHTML =
                '<div class="card">' +
                '<h3><i class="fas fa-calendar-day"></i> Upcoming Events</h3>' +
                '<ul class="event-list">' +
                '<li><span>Science Fair</span> <span class="event-date">Today 10:00 AM</span></li>' +
                '<li><span>Basketball Practice</span> <span class="event-date">Today 3:45 PM</span></li>' +
                '<li><span>Parent-Teacher Meeting</span> <span class="event-date">Today 6:00 PM</span></li>' +
                '<li><span>Math Competition</span> <span class="event-date">Dec 5, 9:00 AM</span></li>' +
                '<li><span>Christmas Program</span> <span class="event-date">Dec 15, 1:00 PM</span></li>' +
                '<li><span>Graduation Ceremony</span> <span class="event-date">Mar 25, 2:00 PM</span></li>' +
                '</ul>' +
                '</div>';
            document.getElementById('assistant-modal').style.display = 'none';
        }
        function AboutUs() {
            const cardGrid = document.getElementById('card-grid');
            cardGrid.innerHTML = `
                <div class="card about-title-card">
                    <h3><i class="fas fa-users"></i> Our Research Team</h3>
                    <p>Meet the dedicated minds behind this project</p>
                </div>
                
                <div class="card member-card">
                    <img src="https://i.pinimg.com/originals/9f/4c/f0/9f4cf0f24b376077a2fcdab2e85c3584.jpg" alt="Clarence Andrei B. Santelices" class="member-image">
                    <div class="member-name">SANTELICES, CLARENCE ANDREI B.</div>
                    <div class="member-role">Research Leader</div>
                </div>

                <div class="card member-card">
                    <img src="https://i.pinimg.com/originals/9f/4c/f0/9f4cf0f24b376077a2fcdab2e85c3584.jpg" alt="Christian Lloyd M. Aragon" class="member-image">
                    <div class="member-name">ARAGON, CHRISTIAN LLOYD M.</div>
                    <div class="member-role">Co-Researcher</div>
                </div>

                <div class="card member-card">
                    <img src="libee.jpg" alt="John Libee L. Galano" class="member-image">
                    <div class="member-name">GALANO, JOHN LIBEE L.</div>
                    <div class="member-role">Co-Researcher</div>
                </div>

                <div class="card member-card">
                    <img src="https://i.pinimg.com/originals/9f/4c/f0/9f4cf0f24b376077a2fcdab2e85c3584.jpg" alt="Mikeria Angela F. Morondos" class="member-image">
                    <div class="member-name">MORONDOS, MIKERIA ANGELA F.</div>
                    <div class="member-role">Co-Researcher</div>
                </div>

                <div class="card member-card">
                    <img src="https://i.pinimg.com/originals/9f/4c/f0/9f4cf0f24b376077a2fcdab2e85c3584.jpg" alt="Christopher P. Cruz" class="member-image">
                    <div class="member-name">CRUZ, CHRISTOPHER P.</div>
                    <div class="member-role">Research Teacher</div>
                </div>
            `;
            document.getElementById('assistant-modal').style.display = 'none';
        }

        function readAnnouncements() {
            const cardGrid = document.getElementById('card-grid');
            cardGrid.innerHTML =
                '<div class="card">' +
                '<h3><i class="fas fa-bullhorn"></i> School Announcements</h3>' +
                '<ul class="event-list">' +
                '<li>Yearbook photos will be taken next week</li>' +
                '<li>Library will close early on Friday</li>' +
                '<li>New cafeteria menu now available</li>' +
                '<li>ID renewal deadline is December 10</li>' +
                '<li>Report cards will be distributed on Friday</li>' +
                '<li>School will be closed on December 25-January 1</li>' +
                '</ul>' +
                '</div>';
            document.getElementById('assistant-modal').style.display = 'none';
        }


        function getDirections() {
            document.getElementById('assistant-modal').style.display = 'none';
            const mapContainer = document.getElementById('map-container');
            mapContainer.scrollIntoView({ behavior: 'smooth' });
        }


        function callSchool() {
            document.getElementById('assistant-modal').style.display = 'none';
            alert('School Contact Numbers:\n\nPrincipal\'s Office: 890-8320\nMain Office: 890-5938\n\nYou can call during office hours (7:00 AM - 5:00 PM)');
        }

        function showDirectory() {
            const cardGrid = document.getElementById('card-grid');
            cardGrid.innerHTML =
                '<div class="card">' +
                '<h3><i class="fas fa-users"></i> Complete Staff Directory</h3>' +
                '<p style="text-align: center; color: #666; font-size: 0.9rem;">Tap an office to locate it</p>' +
                '<ul class="directory-list">' +
                '<li onclick="locateRoom(\'Building A\', \'Backstage\')" style="cursor:pointer;" class="clickable-row"><span>Backstage / Stage</span> <span>Building A, 1st Floor</span></li>' +
                '<li onclick="locateRoom(\'Building A\', \'English Faculty\')" style="cursor:pointer;" class="clickable-row"><span>English Faculty</span> <span>Building A, 2nd Floor</span></li>' +
                '<li onclick="locateRoom(\'Building B\', \'Principal\\\'s Office\')" style="cursor:pointer;" class="clickable-row"><span>Principal\'s Office</span> <span>Building B, 1st Floor</span></li>' +
                '<li onclick="locateRoom(\'Building B\', \'Asst. Principal\')" style="cursor:pointer;" class="clickable-row"><span>Asst. Principal\'s Office</span> <span>Building B, 1st Floor</span></li>' +
                '<li onclick="locateRoom(\'Building B\', \'Registrar\')" style="cursor:pointer;" class="clickable-row"><span>Registrar\'s Office</span> <span>Building B, 1st Floor</span></li>' +
                '<li onclick="locateRoom(\'Building B\', \'Dept. Heads Office\')" style="cursor:pointer;" class="clickable-row"><span>Dept. Heads Office</span> <span>Building B, 1st Floor</span></li>' +
                '<li onclick="locateRoom(\'Building B\', \'Clinic\')" style="cursor:pointer;" class="clickable-row"><span>School Clinic</span> <span>Building B, 1st Floor</span></li>' +
                '<li onclick="locateRoom(\'Building B\', \'Dental Office\')" style="cursor:pointer;" class="clickable-row"><span>Dental Office</span> <span>Building B, 1st Floor</span></li>' +
                '<li onclick="locateRoom(\'Building B\', \'Conference Room\')" style="cursor:pointer;" class="clickable-row"><span>Conference Room</span> <span>Building B, 1st Floor</span></li>' +
                '<li onclick="locateRoom(\'Building B\', \'School Canteen\')" style="cursor:pointer;" class="clickable-row"><span>School Canteen</span> <span>Building B, 1st Floor</span></li>' +
                '<li onclick="locateRoom(\'Building B\', \'Journalism Room\')" style="cursor:pointer;" class="clickable-row"><span>Journalism Room</span> <span>Building B, 2nd Floor</span></li>' +
                '<li onclick="locateRoom(\'Building B\', \'Makerspace\')" style="cursor:pointer;" class="clickable-row"><span>Makerspace</span> <span>Building B, 2nd Floor</span></li>' +
                '<li onclick="locateRoom(\'Building C\', \'JHS Guidance\')" style="cursor:pointer;" class="clickable-row"><span>Guidance Office</span> <span>Building C, 1st Floor</span></li>' +
                '<li onclick="locateRoom(\'Building C\', \'Room 106 (Cookery)\')" style="cursor:pointer;" class="clickable-row"><span>Cookery Laboratory</span> <span>Building C, 1st Floor</span></li>' +
                '<li onclick="locateRoom(\'Building C\', \'Room 105 (TVL)\')" style="cursor:pointer;" class="clickable-row"><span>TVL / FBS Room</span> <span>Building C, 1st Floor</span></li>' +
                '<li onclick="locateRoom(\'Building C\', \'Finance Office\')" style="cursor:pointer;" class="clickable-row"><span>Finance Office</span> <span>Building C, 2nd Floor</span></li>' +
                '<li onclick="locateRoom(\'Building C\', \'Room 204\')" style="cursor:pointer;" class="clickable-row"><span>E-Library</span> <span>Building C, 2nd Floor</span></li>' +
                '<li onclick="locateRoom(\'Building C\', \'Room 201\')" style="cursor:pointer;" class="clickable-row"><span>Computer Lab</span> <span>Building C, 2nd Floor</span></li>' +
                '<li onclick="viewBuilding(\'Building D\')" style="cursor:pointer;" class="clickable-row"><span>SHS Wing</span> <span>Building D</span></li>' +
                '</ul>' +
                '</div>';
            document.getElementById('assistant-modal').style.display = 'none';
        }

        function viewNews() {
            const cardGrid = document.getElementById('card-grid');
            cardGrid.innerHTML = `
                <div class="card about-title-card">
                    <h3><i class="fas fa-newspaper"></i> Campus News</h3>
                    <p>Stay updated with our latest social media posts</p>
                </div>

                <div class="card" style="grid-column: 1 / -1; display: flex; justify-content: center; overflow: hidden;">
                    <!-- Facebook Page Plugin Iframe -->
                    <!-- REPLACE 'https://www.facebook.com/MakatiScienceHighSchool' WITH YOUR ACTUAL FB PAGE URL ENCODED -->
                    <!-- Example: https%3A%2F%2Fwww.facebook.com%2FYourPageName -->
                    <iframe src="https://www.facebook.com/plugins/page.php?href=https%3A%2F%2Fwww.facebook.com%2Ffacebook&tabs=timeline&width=500&height=800&small_header=false&adapt_container_width=true&hide_cover=false&show_facepile=true&appId" width="500" height="800" style="border:none;overflow:hidden; max-width: 100%;" scrolling="no" frameborder="0" allowfullscreen="true" allow="autoplay; clipboard-write; encrypted-media; picture-in-picture; web-share"></iframe>
                    
                    <div style="margin-top: 20px; text-align: center; color: #666; font-size: 0.9rem; width: 100%; display: none;">
                        <p>To change the Facebook page, edit the <code>src</code> attribute in the <code>viewNews</code> function inside Kiosk.html</p>
                    </div>
                </div>
            `;
            document.getElementById('assistant-modal').style.display = 'none';
        }

        function openChatbot() {
            document.getElementById('assistant-modal').style.display = 'none';
            const cardGrid = document.getElementById('card-grid');
            cardGrid.innerHTML = `
                <div class="card about-title-card">
                    <h3><i class="fas fa-robot"></i> AI Assistant</h3>
                    <p>Ask me anything about the school!</p>
                </div>
                
                <div class="card" style="grid-column: 1 / -1; min-height: 400px; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center;">
                    <div style="font-size: 3rem; color: #4ca1af; margin-bottom: 20px;">
                        <i class="fas fa-comments"></i>
                    </div>
                    <h4>Chatbot Integration Placeholder</h4>
                    <p style="color: #666; max-width: 400px; margin-bottom: 20px;">
                        This area is ready for a chatbot integration. You can embed a service like Tidio, Chatbase, or a custom AI interface here.
                    </p>
                    <button class="assistant-btn" onclick="location.reload()" style="width: auto; padding: 10px 20px;">
                        <i class="fas fa-redo"></i> Reset View
                    </button>
                </div>
            `;
        }

        function checkSearchEnter(event) {
            if (event.key === "Enter") {
                performSearch();
            }
        }

        // Specific Room Search Functions
        function viewSpecificRoom(buildingName, roomCode, roomData) {
            const cardGrid = document.getElementById('card-grid');

            // Construct image path if not directly provided in data
            let imgSrc = roomData ? roomData.img : `${buildingName} Room ${roomCode}.jpg`;
            // Fallback for simple room number mapping if roomData is null but code exists
            if (!roomData && buildingImages[buildingName] && buildingImages[buildingName].rooms && buildingImages[buildingName].rooms[roomCode]) {
                imgSrc = buildingImages[buildingName].rooms[roomCode];
            }

            const label = roomData ? roomData.label : `Room ${roomCode}`;
            const desc = roomData ? roomData.desc : 'Standard Classroom';

            // Determine floor display safely
            let floorDisplay = "Unknown Floor";
            if (roomData && roomData.floor) {
                floorDisplay = "Floor " + roomData.floor;
            } else if (roomCode && !isNaN(roomCode.charAt(0))) {
                floorDisplay = "Floor " + roomCode.charAt(0);
            } else {
                // Fallback if we can't determine floor from code or data
                floorDisplay = "See Directory";
            }

            cardGrid.innerHTML = `
                <div class="card" style="grid-column: 1 / -1; display:flex; align-items:center; gap:15px; background:linear-gradient(to right, #4ca1af, #2c3e50); color:white;">
                    <button onclick="viewBuilding('${buildingName}')" style="background:rgba(255,255,255,0.2); border:none; color:white; padding:10px 15px; border-radius:5px; cursor:pointer; font-size:1rem;">
                        <i class="fas fa-arrow-left"></i> See All ${buildingName}
                    </button>
                    <h3 style="margin:0; border:none; color:white;">Search Result: ${label}</h3>
                </div>
                
                <div class="card" style="grid-column: 1 / -1; max-width: 600px; margin: 0 auto; transform: none;">
                    <img src="${imgSrc}" onerror="this.src='placeholderimg.jpg'" style="width:100%; height:300px; object-fit:cover; border-radius:8px; margin-bottom:15px;" alt="${label}">
                    <h3 style="color:#2c3e50; text-align:center; border-bottom:1px solid #eee;">${label}</h3>
                    <div style="margin-top:10px; text-align:center;">
                        <span style="background:#f0f2f5; color:#555; padding:5px 10px; border-radius:15px; font-size:0.9rem; margin-right:10px;">
                            <i class="fas fa-building"></i> ${buildingName}
                        </span>
                        <span style="background:#f0f2f5; color:#555; padding:5px 10px; border-radius:15px; font-size:0.9rem;">
                            <i class="fas fa-layer-group"></i> ${floorDisplay}
                        </span>
                    </div>
                    <p style="text-align:center; color:#666; margin-top:15px;">${desc}</p>

                    <!-- Navigation Placeholder Card -->
                    <div onclick="showNavigation('${buildingName}', '${label}')" style="margin-top: 20px; border: 2px dashed #4ca1af; border-radius: 10px; padding: 15px; background: #f9ffff; cursor: pointer; transition: background 0.3s; text-align: center;">
                        <div style="font-size: 2rem; color: #4ca1af; margin-bottom: 10px;"><i class="fas fa-map-marked-alt"></i></div>
                        <h4 style="color: #2c3e50; margin-bottom: 5px;">Tap for Directions</h4>
                        <p style="color: #666; font-size: 0.9rem;">Show path from Kiosk to ${label}</p>
                    </div>
                </div>
            `;

            document.getElementById('assistant-modal').style.display = 'none';
        }

        function showNoResults(query) {
            const cardGrid = document.getElementById('card-grid');
            cardGrid.innerHTML = `
                <div class="card" style="grid-column: 1 / -1; display:flex; align-items:center; gap:15px; background:linear-gradient(to right, #e74c3c, #c0392b); color:white;">
                    <button onclick="showCampusDirectory()" style="background:rgba(255,255,255,0.2); border:none; color:white; padding:10px 15px; border-radius:5px; cursor:pointer; font-size:1rem;">
                        <i class="fas fa-arrow-left"></i> Specific Rooms
                    </button>
                    <h3 style="margin:0; border:none; color:white;">No Results Found</h3>
                </div>

                <div class="card" style="grid-column: 1 / -1; min-height: 300px; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center;">
                    <div style="font-size: 4rem; color: #ecf0f1; margin-bottom: 20px;"><i class="fas fa-search-minus"></i></div>
                    <h4 style="color: #7f8c8d; margin-bottom: 10px;">We couldn't find "${query}"</h4>
                    <p style="color: #95a5a6; max-width: 400px; margin-bottom: 20px;">
                        The item you are looking for does not exist in our database. Please check the spelling or try searching for major facilities like "Library", "Clinic", or "Canteen".
                    </p>
                    <button onclick="document.getElementById('search-input').focus()" style="padding: 10px 20px; background: #3498db; color: white; border: none; border-radius: 5px; cursor: pointer;">
                        <i class="fas fa-search"></i> Search Again
                    </button>
                </div>
             `;
            document.getElementById('assistant-modal').style.display = 'none';
        }

        // Helper to locate room data from directory click
        function locateRoom(buildingName, roomLabel) {
            let foundRoomData = null;
            let foundFloor = null;
            const bData = buildingImages[buildingName];

            if (bData && bData.floorData) {
                for (let floor in bData.floorData) {
                    const rooms = bData.floorData[floor];
                    // Exact match or contains
                    const match = rooms.find(r => r.label === roomLabel || r.label.includes(roomLabel));
                    if (match) {
                        foundRoomData = match;
                        foundFloor = floor;
                        break;
                    }
                }
            }

            if (foundRoomData) {
                // Pass found floor explicitly since label might not have numbers (e.g. Principal's Office)
                foundRoomData.floor = foundFloor;
                viewSpecificRoom(buildingName, roomLabel, foundRoomData);
            } else {
                // Fallback if data structure mismatch, try to show something reasonable or just navigation
                // If we have building name and label, we can at least show navigation
                showNavigation(buildingName, roomLabel);
            }
        }

        function showNavigation(buildingName, destinationLabel) {
            const cardGrid = document.getElementById('card-grid');

            // Try to find the room data to get the directional image
            let directionalImage = 'https://via.placeholder.com/600x400?text=Map+Route+Placeholder';
            let roomFound = false;

            // Search through building data for the room
            const bData = buildingImages[buildingName];
            if (bData && bData.floorData) {
                for (let floor in bData.floorData) {
                    const rooms = bData.floorData[floor];
                    const match = rooms.find(r => r.label === destinationLabel || r.label.includes(destinationLabel));
                    if (match && match.directions) {
                        directionalImage = match.directions;
                        roomFound = true;
                        break;
                    }
                }
            }

            cardGrid.innerHTML = `
                <div class="card" style="grid-column: 1 / -1; display:flex; align-items:center; gap:15px; background:linear-gradient(to right, #3498db, #2c3e50); color:white;">
                    <button onclick="window.history.back(); location.reload();" style="background:rgba(255,255,255,0.2); border:none; color:white; padding:10px 15px; border-radius:5px; cursor:pointer; font-size:1rem;">
                        <i class="fas fa-arrow-left"></i> Back
                    </button>
                    <!-- Or ideally back to previous view if we managed state, but reload is safe fallback for prototype -->
                     <h3 style="margin:0; border:none; color:white;">Navigation: Route to ${destinationLabel}</h3>
                </div>

                <div class="card" style="grid-column: 1 / -1; min-height: 400px; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center;">
                    <img src="${directionalImage}" onerror="this.src='https://via.placeholder.com/600x400?text=Map+Route+Placeholder'" alt="Navigation Map" style="max-width: 100%; border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); margin-bottom: 20px;">
                    
                    <div style="background: #e8f6f3; padding: 20px; border-radius: 10px; border-left: 5px solid #2ecc71; max-width: 600px; width: 100%; text-align: left;">
                        <h4 style="color: #2c3e50; margin-bottom: 15px;"><i class="fas fa-walking"></i> Directions</h4>
                        <ol style="padding-left: 20px; line-height: 1.6; color: #555;">
                            <li>Start at the <strong>Main Kiosk</strong> near the gate.</li>
                            <li>Walk straight ahead towards the quadrangle.</li>
                            <li>Turn towards <strong>${buildingName}</strong>.</li>
                            <li>Proceed to the designated floor.</li>
                            <li>Look for <strong>${destinationLabel}</strong>.</li>
                        </ol>
                    </div>
                    
                    <button onclick="location.reload()" style="margin-top: 20px; padding: 10px 20px; background: #2c3e50; color: white; border: none; border-radius: 5px; cursor: pointer;">
                        <i class="fas fa-check"></i> Done
                    <button onclick="document.getElementById('search-input').focus()" style="padding: 10px 20px; background: #3498db; color: white; border: none; border-radius: 5px; cursor: pointer;">
                        <i class="fas fa-search"></i> Search Again
                    </button>
                </div>
             `;
            document.getElementById('assistant-modal').style.display = 'none';
        }

        function performSearch() {
            const query = document.getElementById('search-input').value.toLowerCase().trim();
            if (!query) return;

            // 1. Specific Room Search Logic
            const buildingMatch = query.match(/(?:building|bldg)\s*([a-d])/i);
            const roomMatch = query.match(/(?:room|rm)?\s*(\d{3})/i);

            if (buildingMatch && roomMatch) {
                const buildingLetter = buildingMatch[1].toUpperCase();
                const buildingName = "Building " + buildingLetter;
                const roomCode = roomMatch[1];

                let foundRoomData = null;
                let roomExists = false;
                const bData = buildingImages[buildingName];

                if (bData) {
                    // Check floorData
                    if (bData.floorData) {
                        for (let floor in bData.floorData) {
                            const rooms = bData.floorData[floor];
                            const match = rooms.find(r => r.label.includes(roomCode));
                            if (match) {
                                foundRoomData = match;
                                // Inject floor for display safety
                                foundRoomData.floor = floor;
                                roomExists = true;
                                break;
                            }
                        }
                    }
                    // Check rooms fallback
                    if (!roomExists && bData.rooms && bData.rooms[roomCode]) {
                        roomExists = true;
                        // foundRoomData remains null, but existence is confirmed so we use fallback display logic
                    }
                }

                if (roomExists) {
                    viewSpecificRoom(buildingName, roomCode, foundRoomData);
                } else {
                    showNoResults(query);
                }
                return;
            }

            // 2. Keyword Mappings
            if (query.includes("map") || query.includes("directory") || query.includes("building") || query.includes("floor")) {
                showCampusDirectory();
            } else if (query.includes("event") || query.includes("calendar") || query.includes("schedule")) {
                viewEvents();
            } else if (query.includes("news") || query.includes("facebook") || query.includes("social")) {
                viewNews();
            } else if (query.includes("announcement") || query.includes("notice") || query.includes("update")) {
                readAnnouncements();
            } else if (query.includes("about") || query.includes("team") || query.includes("research") || query.includes("who")) {
                AboutUs();
            } else if (query.includes("survey") || query.includes("feedback") || query.includes("rate")) {
                viewSurvey();
            } else if (query.includes("help") || query.includes("guide") || query.includes("faq") || query.includes("support")) {
                viewHelp();
            } else if (query.includes("navigate") || query.includes("room") || query.includes("find") || query.includes("location")) {
                navigateRooms();
            } else if (query.includes("chat") || query.includes("ai") || query.includes("robot") || query.includes("assistant")) {
                openChatbot();
            } else {
                showNoResults(query);
            }
        }

        // Navigate Rooms function
        function navigateRooms() {
            const cardGrid = document.getElementById('card-grid');
            cardGrid.innerHTML =
                '<div class="card">' +
                '<h3><i class="fas fa-door-open"></i> Room Directory</h3>' +
                '<p style="text-align: center; color: #666; font-size: 0.9rem;">Tap a room to locate it</p>' +
                '<ul class="directory-list">' +
                '<li onclick="locateRoom(\'Building A\', \'Backstage\')" style="cursor:pointer;" class="clickable-row"><span>Backstage / Stage</span> <span>Building A, 1st Floor</span></li>' +
                '<li onclick="locateRoom(\'Building A\', \'English Faculty\')" style="cursor:pointer;" class="clickable-row"><span>English Faculty</span> <span>Building A, 2nd Floor</span></li>' +
                '<li onclick="locateRoom(\'Building B\', \'Principal\\\'s Office\')" style="cursor:pointer;" class="clickable-row"><span>Principal\'s Office</span> <span>Building B, 1st Floor</span></li>' +
                '<li onclick="locateRoom(\'Building B\', \'Asst. Principal\')" style="cursor:pointer;" class="clickable-row"><span>Asst. Principal\'s Office</span> <span>Building B, 1st Floor</span></li>' +
                '<li onclick="locateRoom(\'Building B\', \'Registrar\')" style="cursor:pointer;" class="clickable-row"><span>Registrar\'s Office</span> <span>Building B, 1st Floor</span></li>' +
                '<li onclick="locateRoom(\'Building B\', \'Dept. Heads Office\')" style="cursor:pointer;" class="clickable-row"><span>Dept. Heads Office</span> <span>Building B, 1st Floor</span></li>' +
                '<li onclick="locateRoom(\'Building B\', \'Clinic\')" style="cursor:pointer;" class="clickable-row"><span>School Clinic</span> <span>Building B, 1st Floor</span></li>' +
                '<li onclick="locateRoom(\'Building B\', \'Dental Office\')" style="cursor:pointer;" class="clickable-row"><span>Dental Office</span> <span>Building B, 1st Floor</span></li>' +
                '<li onclick="locateRoom(\'Building B\', \'Conference Room\')" style="cursor:pointer;" class="clickable-row"><span>Conference Room</span> <span>Building B, 1st Floor</span></li>' +
                '<li onclick="locateRoom(\'Building B\', \'School Canteen\')" style="cursor:pointer;" class="clickable-row"><span>School Canteen</span> <span>Building B, 1st Floor</span></li>' +
                '<li onclick="locateRoom(\'Building B\', \'Journalism Room\')" style="cursor:pointer;" class="clickable-row"><span>Journalism Room</span> <span>Building B, 2nd Floor</span></li>' +
                '<li onclick="locateRoom(\'Building B\', \'Makerspace\')" style="cursor:pointer;" class="clickable-row"><span>Makerspace</span> <span>Building B, 2nd Floor</span></li>' +
                '<li onclick="locateRoom(\'Building C\', \'JHS Guidance\')" style="cursor:pointer;" class="clickable-row"><span>Guidance Office</span> <span>Building C, 1st Floor</span></li>' +
                '<li onclick="locateRoom(\'Building C\', \'Room 106 (Cookery)\')" style="cursor:pointer;" class="clickable-row"><span>Cookery Laboratory</span> <span>Building C, 1st Floor</span></li>' +
                '<li onclick="locateRoom(\'Building C\', \'Room 105 (TVL)\')" style="cursor:pointer;" class="clickable-row"><span>TVL / FBS Room</span> <span>Building C, 1st Floor</span></li>' +
                '<li onclick="locateRoom(\'Building C\', \'Finance Office\')" style="cursor:pointer;" class="clickable-row"><span>Finance Office</span> <span>Building C, 2nd Floor</span></li>' +
                '<li onclick="locateRoom(\'Building C\', \'Room 204\')" style="cursor:pointer;" class="clickable-row"><span>E-Library</span> <span>Building C, 2nd Floor</span></li>' +
                '<li onclick="locateRoom(\'Building C\', \'Room 201\')" style="cursor:pointer;" class="clickable-row"><span>Computer Lab</span> <span>Building C, 2nd Floor</span></li>' +
                // SHS Wing is generic, just view viewBuilding D
                '<li onclick="viewBuilding(\'Building D\')" style="cursor:pointer;" class="clickable-row"><span>SHS Wing</span> <span>Building D</span></li>' +
                '</ul>' +
                '</div>';
            document.getElementById('assistant-modal').style.display = 'none';
        }

        function viewHelp() {
            const cardGrid = document.getElementById('card-grid');
            cardGrid.innerHTML = `
                <div class="card about-title-card">
                    <h3><i class="fas fa-question-circle"></i> Help Center</h3>
                    <p>Frequently Asked Questions and Support</p>
                </div>

                <div class="card">
                    <h3><i class="fas fa-book"></i> User Guide</h3>
                    <p style="margin-bottom: 15px; color: #555;">Learn how to navigate the Smart Kiosk effectively.</p>
                    <ul class="directory-list">
                        <li><span>Searching</span> <span>Use sidebar search</span></li>
                        <li><span>Navigation</span> <span>Click Map for directions</span></li>
                        <li><span>Assistant</span> <span>Click the logo icon</span></li>
                    </ul>
                </div>

                <div class="card">
                    <h3><i class="fas fa-comments"></i> FAQ</h3>
                    <ul class="directory-list">
                        <li>
                            <div style="width: 100%">
                                <strong style="display:block; color:#2c3e50; margin-bottom:5px;">How do I find a room?</strong>
                                <span style="font-size: 0.9rem; color: #666;">Use the "Campus Directory" or ask the Assistant to "Navigate Rooms".</span>
                            </div>
                        </li>
                        <li>
                            <div style="width: 100%">
                                <strong style="display:block; color:#2c3e50; margin-bottom:5px;">Where is the clinic?</strong>
                                <span style="font-size: 0.9rem; color: #666;">The clinic is located in Building A, Room 115.</span>
                            </div>
                        </li>
                    </ul>
                </div>

                <div class="card">
                    <h3><i class="fas fa-headset"></i> Contact Support</h3>
                    <p style="margin-bottom: 15px; color: #555;">Need immediate assistance?</p>
                    <div style="text-align: center;">
                        <button class="assistant-btn" onclick="callSchool()" style="width: 100%; margin-bottom: 10px;"><i class="fas fa-phone"></i> Call Admin Office</button>
                        <p style="font-size: 0.85rem; color: #888;">Available 7:00 AM - 5:00 PM</p>
                    </div>
                    <div style="margin-top: 20px; border-top: 1px solid #eee; padding-top: 15px;">
                        <button onclick="exportData()" style="background: none; border: none; font-size: 0.8rem; color: #999; cursor: pointer;">
                            <i class="fas fa-download"></i> Admin: Export Data
                        </button>
                    </div>
                </div>
            `;
            document.getElementById('assistant-modal').style.display = 'none';
        }
    </script>

    <!-- Virtual Keyboard -->
    <div class="keyboard-container" id="virtual-keyboard">
        <button class="key close-keyboard" onclick="closeKeyboard()"><i class="fas fa-times"></i> Close</button>
        <div class="keyboard-row">
            <button class="key" onclick="typeKey('1')">1</button>
            <button class="key" onclick="typeKey('2')">2</button>
            <button class="key" onclick="typeKey('3')">3</button>
            <button class="key" onclick="typeKey('4')">4</button>
            <button class="key" onclick="typeKey('5')">5</button>
            <button class="key" onclick="typeKey('6')">6</button>
            <button class="key" onclick="typeKey('7')">7</button>
            <button class="key" onclick="typeKey('8')">8</button>
            <button class="key" onclick="typeKey('9')">9</button>
            <button class="key" onclick="typeKey('0')">0</button>
        </div>
        <div class="keyboard-row">
            <button class="key" onclick="typeKey('Q')">Q</button>
            <button class="key" onclick="typeKey('W')">W</button>
            <button class="key" onclick="typeKey('E')">E</button>
            <button class="key" onclick="typeKey('R')">R</button>
            <button class="key" onclick="typeKey('T')">T</button>
            <button class="key" onclick="typeKey('Y')">Y</button>
            <button class="key" onclick="typeKey('U')">U</button>
            <button class="key" onclick="typeKey('I')">I</button>
            <button class="key" onclick="typeKey('O')">O</button>
            <button class="key" onclick="typeKey('P')">P</button>
        </div>
        <div class="keyboard-row">
            <button class="key special" id="caps-lock-btn" onclick="toggleCapsLock()"><i
                    class="fas fa-arrow-up"></i></button>
            <button class="key" onclick="typeKey('A')">A</button>
            <button class="key" onclick="typeKey('S')">S</button>
            <button class="key" onclick="typeKey('D')">D</button>
            <button class="key" onclick="typeKey('F')">F</button>
            <button class="key" onclick="typeKey('G')">G</button>
            <button class="key" onclick="typeKey('H')">H</button>
            <button class="key" onclick="typeKey('J')">J</button>
            <button class="key" onclick="typeKey('K')">K</button>
            <button class="key" onclick="typeKey('L')">L</button>
        </div>
        <div class="keyboard-row">
            <button class="key" onclick="typeKey('Z')">Z</button>
            <button class="key" onclick="typeKey('X')">X</button>
            <button class="key" onclick="typeKey('C')">C</button>
            <button class="key" onclick="typeKey('V')">V</button>
            <button class="key" onclick="typeKey('B')">B</button>
            <button class="key" onclick="typeKey('N')">N</button>
            <button class="key" onclick="typeKey('M')">M</button>
            <button class="key special" onclick="typeKey('BACKSPACE')"><i class="fas fa-backspace"></i></button>
        </div>
        <div class="keyboard-row">
            <button class="key space" onclick="typeKey('SPACE')">SPACE</button>
            <button class="key special" onclick="typeKey('ENTER')">ENTER</button>
        </div>
    </div>

    <!-- Keyboard Script -->
    <script>
        let currentInput = null;
        let isCapsLock = false;

        function toggleCapsLock() {
            isCapsLock = !isCapsLock;
            const capsBtn = document.getElementById('caps-lock-btn');
            const keys = document.querySelectorAll('.key:not(.special):not(.space):not(.close-keyboard)');

            if (isCapsLock) {
                capsBtn.style.backgroundColor = '#3498db'; // Active state color
                capsBtn.style.color = 'white';
                keys.forEach(key => {
                    key.textContent = key.textContent.toUpperCase();
                });
            } else {
                capsBtn.style.backgroundColor = '#ecf0f1'; // Inactive state
                capsBtn.style.color = '#2c3e50';
                keys.forEach(key => {
                    // Only change letters to lowercase, leave numbers/symbols if any (currently only chars are uppercase in HTML)
                    // But wait, the innerText is what we change. HTML onclick remains "typeKey('A')".
                    // So visually we show 'a', but onclick sends 'A'.
                    // We need to handle this in typeKey.
                    if (key.textContent.length === 1 && key.textContent.match(/[A-Z]/)) {
                        key.textContent = key.textContent.toLowerCase();
                    }
                    // Actually keys are 0-9 and A-Z. 0-9 toLowerCase is same.
                    key.textContent = key.textContent.toLowerCase();
                });
            }
        }

        function closeKeyboard() {
            document.getElementById('virtual-keyboard').style.display = 'none';
            // Remove padding to reset view
            document.body.style.paddingBottom = '0';
        }

        function showKeyboard(inputElement) {
            currentInput = inputElement;
            document.getElementById('virtual-keyboard').style.display = 'block';

            // Unset Caps Lock on open to ensure consistent state or keep previous?
            // Usually valid to keep previous, but let's sync visual state if we want to be safe
            // For now, let's just leave it as is.

            // Ensure visual state matches isCapsLock (in case it was modified elsewhere or first load)
            // Actually, the keys are hardcoded UPPER in HTML.
            // On first load isCapsLock is false.
            // But we haven't run the toggle logic to set them to lower visual yet?
            // On first open, we should probably initialize functionality or just default to Upper?
            // Standard mobile keyboards start Lower.
            // Let's force update visual state on show.
            const keys = document.querySelectorAll('.key:not(.special):not(.space):not(.close-keyboard)');
            keys.forEach(key => {
                if (isCapsLock) {
                    key.textContent = key.textContent.toUpperCase();
                } else {
                    key.textContent = key.textContent.toLowerCase();
                }
            });
            const capsBtn = document.getElementById('caps-lock-btn');
            if (capsBtn) {
                if (isCapsLock) {
                    capsBtn.style.backgroundColor = '#3498db';
                    capsBtn.style.color = 'white';
                } else {
                    capsBtn.style.backgroundColor = '#ecf0f1';
                    capsBtn.style.color = '#2c3e50';
                }
            }

            // Add padding to body so keyboard doesn't cover content

            // Add padding to body so keyboard doesn't cover content
            document.body.style.paddingBottom = '350px';

            // Scroll element into view if needed
            setTimeout(() => {
                inputElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }, 300);
        }

        function typeKey(key) {
            if (!currentInput) return;

            if (key === 'BACKSPACE') {
                currentInput.value = currentInput.value.slice(0, -1);
            } else if (key === 'SPACE') {
                currentInput.value += ' ';
            } else if (key === 'ENTER') {
                // Create and dispatch an Enter key event
                const enterEvent = new KeyboardEvent('keypress', {
                    key: 'Enter',
                    code: 'Enter',
                    keyCode: 13,
                    which: 13,
                    bubbles: true
                });
                currentInput.dispatchEvent(enterEvent);
                return;
            } else {
                // If the key is a letter, check capitalization logic if needed
                let charToType = key;
                if (key.length === 1 && /[a-zA-Z]/.test(key)) {
                    charToType = isCapsLock ? key.toUpperCase() : key.toLowerCase();
                }
                currentInput.value += charToType;
            }

            // Trigger input event so any listeners update (though none for now)
            currentInput.dispatchEvent(new Event('input', { bubbles: true }));
        }

        // Use event delegation for dynamically created survey inputs
        document.addEventListener('focusin', function (e) {
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
                // Check if it's a text-like input
                // text, number, email, password, etc. but NOT radio, checkbox, submit, button
                const type = e.target.type;
                const validTypes = ['text', 'number', 'email', 'textarea', 'password', 'search', 'tel', 'url'];

                if (validTypes.includes(type) || e.target.tagName === 'TEXTAREA') {
                    showKeyboard(e.target);
                }
            }
        });
    </script>

</body>

</html>